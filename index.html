<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>怡千金的微信</title>
    <meta name="theme-color" content="#07c160">
    <!-- PWA 支持 -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", sans-serif; 
        }
        html, body { 
            height: 100%; 
            overflow: hidden; 
            background: #ededed; 
            -webkit-font-smoothing: antialiased;
        }

        /* 全屏容器 */
        #app { 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            background: #f8f8f8; 
        }

        /* 1. 顶部状态栏 (模仿手机) */
        .status-bar { 
            height: 20px; 
            background: #000; 
            color: white; 
            padding: 0 15px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-size: 12px; 
            line-height: 1;
        }
        .status-left { 
            display: flex; 
            align-items: center; 
        }
        .time { 
            font-weight: 600; 
            margin-right: 5px; 
        }
        .status-right i { 
            margin-left: 8px; 
            font-size: 12px; 
        }

        /* 2. 微信首页标题栏 - 恢复原有样式（首页显示） */
        .navbar-home {
            height: 44px;
            background: #ededed;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border-bottom: 1px solid #dcdcdc;
            flex-shrink: 0; /* 防止压缩 */
            padding-top: 4px;
        }
        .navbar-home .title {
            font-size: 17px;
            font-weight: 500;
            color: #000;
        }
        .navbar-home .icons-right {
            position: absolute;
            right: 12px;
            display: flex;
            align-items: center;
        }
        .navbar-home .icons-right i {
            font-size: 22px;
            color: #000;
            margin-left: 20px;
        }

        /* 3. 主内容区 */
        .main-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* 会话列表容器 */
        .sessions-container {
            flex: 1;
            overflow-y: auto;
            display: block;
        }

        /* 聊天会话列表样式 */
        .sessions-list .session-item {
            display: flex;
            align-items: center;
            padding: 12px;
            background: white;
            border-bottom: 1px solid #f0f0f0;
        }
        .session-avatar {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: #07c160;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 12px;
            flex-shrink: 0;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .session-info { 
            flex: 1; 
            min-width: 0; 
        }
        .session-row1 {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        .session-name {
            font-size: 17px;
            color: #000;
            font-weight: 500;
        }
        .session-time {
            font-size: 13px;
            color: #8a8a8a;
        }
        .session-row2 {
            display: flex;
            justify-content: space-between;
        }
        .session-preview {
            font-size: 14px;
            color: #8a8a8a;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 80%;
        }
        .unread-badge {
            background: #fa5151;
            color: white;
            font-size: 12px;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 5px;
        }

        /* 5. 聊天窗口 */
        .chat-view {
            height: 100%;
            display: none;
            flex-direction: column;
            flex: 1;
            overflow: hidden;
        }
        /* 聊天窗口标题栏 */
        .chat-header {
            height: 44px;
            background: #ededed;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 12px;
            border-bottom: 1px solid #dcdcdc;
            flex-shrink: 0; /* 防止压缩 */
        }
        .chat-back-btn {
            background: none;
            border: none;
            color: #000;
            font-size: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }
        .chat-contact-name {
            font-size: 17px;
            font-weight: 500;
            color: #000;
            text-align: center;
            flex: 1;
        }
        .chat-more-btn {
            background: none;
            border: none;
            color: #000;
            font-size: 20px;
            cursor: pointer;
            flex-shrink: 0;
        }
        /* 消息区域 */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f0f0f0;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjIwIiBmaWxsPSIjZjBmMGYwIi8+PHBhdGggZD0iTTAgMEwyMCAyME0yMCAwTDAgMjAiIHN0cm9rZT0iI2U5ZTllOSIgc3Ryb2tlLXdpZHRoPSIxIi8+PC9zdmc+');
        }
        .message {
            display: flex;
            margin-bottom: 20px;
            align-items: flex-start; /* 头像与消息框顶部对齐 */
        }
        .message.received { justify-content: flex-start; }
        .message.sent { justify-content: flex-end; }
        
        /* 消息头像样式 */
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: #07c160;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
            /* 微调：增加一点顶部间距，视觉更自然 */
            margin-top: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .message.received .message-avatar {
            margin-right: 10px; /* 接收消息头像右侧间距 */
        }
        .message.sent .message-avatar {
            margin-left: 10px; /* 发送消息头像左侧间距 */
        }
        
        .message-content {
            max-width: 70%;
            padding: 10px 14px;
            border-radius: 18px;
            position: relative;
            word-wrap: break-word;
            font-size: 16px;
            line-height: 1.4;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .message.received .message-content {
            background: white;
            border-top-left-radius: 4px;
        }
        .message.sent .message-content {
            background: #95ec69;
            border-top-right-radius: 4px;
        }
        /* 消息气泡箭头 */
        .message.received .message-content::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 10px;
            border: 6px solid transparent;
            border-right-color: white;
        }
        .message.sent .message-content::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 10px;
            border: 6px solid transparent;
            border-left-color: #95ec69;
        }
        /* 消息时间 */
        .message-time {
            font-size: 11px;
            color: #8a8a8a;
            margin-top: 5px;
            text-align: center;
        }
        .message-date {
            text-align: center;
            margin: 20px 0;
        }
        .date-label {
            display: inline-block;
            background: #d8d8d8;
            color: #666;
            font-size: 12px;
            padding: 4px 12px;
            border-radius: 12px;
        }

        /* 6. 聊天输入工具栏 */
        .chat-toolbar {
            height: 56px;
            background: #f8f8f8;
            border-top: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            padding: 0 12px;
            flex-shrink: 0; /* 防止压缩 */
        }
        .toolbar-left, .toolbar-right {
            display: flex;
            align-items: center;
        }
        .tool-btn {
            background: none;
            border: none;
            color: #7d7d7d;
            font-size: 22px;
            padding: 8px;
            margin: 0 2px;
            cursor: pointer;
        }
        .input-box {
            flex: 1;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 18px;
            padding: 8px 15px;
            margin: 0 8px;
            max-height: 80px;
            overflow-y: auto;
            font-size: 16px;
            line-height: 1.4;
            outline: none;
            min-height: 36px;
            box-sizing: border-box;
            cursor: text;
        }
        /* 为可编辑的div添加placeholder效果 */
        .input-box:empty:before {
            content: attr(placeholder);
            color: #b2b2b2;
        }
        
        /* 滚动条样式 */
        .sessions-container::-webkit-scrollbar {
            width: 4px;
        }
        .sessions-container::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .sessions-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }
        .chat-messages::-webkit-scrollbar-track {
            background: transparent;
        }
        .chat-messages::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 2px;
        }
        
        /* 微信下拉刷新效果 */
        .pull-to-refresh {
            position: absolute;
            top: -40px;
            left: 0;
            right: 0;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8a8a8a;
            font-size: 14px;
        }
        
        /* 消息气泡动画 */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message {
            animation: fadeIn 0.3s ease-out;
        }
        
        /* 状态栏图标样式优化 */
        .status-right i {
            -webkit-text-stroke: 0.5px rgba(255,255,255,0.2);
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 顶部状态栏 -->
        <div class="status-bar">
            <div class="status-left">
                <span class="time" id="currentTime">14:30</span>
            </div>
            <div class="status-right">
                <i class="fas fa-signal" title="信号"></i>
                <i class="fas fa-wifi" title="WiFi"></i>
                <i class="fas fa-battery-three-quarters" title="电量"></i>
            </div>
        </div>

        <!-- 微信首页标题栏（首页显示，聊天页隐藏） -->
        <div class="navbar-home">
            <div class="title">微信</div>
            <div class="icons-right">
                <i class="fas fa-search" title="搜索"></i>
                <i class="fas fa-plus-circle" title="添加"></i>
            </div>
        </div>

        <!-- 主内容区：默认显示聊天会话列表 -->
        <div class="main-content" id="mainContent">
            <!-- 聊天会话列表容器 -->
            <div class="sessions-container">
                <div class="pull-to-refresh" id="pullToRefresh">下拉刷新</div>
                <div class="sessions-list" id="sessionsList">
                    <!-- 会话列表将通过JavaScript动态生成 -->
                </div>
            </div>

            <!-- 聊天窗口 1: 老爷子 -->
            <div class="chat-view" id="chatOldman">
                <div class="chat-header">
                    <button class="chat-back-btn" onclick="backToSessions()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="chat-contact-name">老爷子</div>
                    <button class="chat-more-btn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="chat-messages">
                    <div class="message-date">
                        <span class="date-label">MG13年1月22日 12:56</span>
                    </div>
                    <div class="message received">
                        <div class="message-avatar">老</div>
                        <div class="message-content">我重金购买了火种计划的门票，你收好。这是关乎所有人未来的重要凭证，一定要妥善保管。</div>
                    </div>
                    <div class="message sent">
                        <div class="message-content">那些留下的人怎么办？难道就只能任由他们暴露在X病毒的威胁下吗？我不能接受这样的安排。</div>
                        <div class="message-avatar">怡</div>
                    </div>
                    <div class="message-date">
                        <span class="date-label">MG13年5月12日 08:45</span>
                    </div>
                    <div class="message received">
                        <div class="message-avatar">老</div>
                        <div class="message-content">不用去了，有方法解决X病毒了。科研团队已经找到了病毒的抑制方案，很快就能普及到所有人。</div>
                    </div>
                </div>
                <!-- 聊天输入工具栏 -->
                <div class="chat-toolbar">
                    <button class="tool-btn"><i class="fas fa-microphone"></i></button>
                    <div class="input-box" contenteditable="true" placeholder="输入消息..."></div>
                    <button class="tool-btn"><i class="far fa-smile"></i></button>
                    <button class="tool-btn"><i class="fas fa-plus-circle"></i></button>
                </div>
            </div>

            <!-- 聊天窗口 2: 主治医生 -->
            <div class="chat-view" id="chatDoctor">
                <div class="chat-header">
                    <button class="chat-back-btn" onclick="backToSessions()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="chat-contact-name">不重要的主治医生</div>
                    <button class="chat-more-btn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="chat-messages">
                    <div class="message-date">
                        <span class="date-label">MG20年2月1日 05:21</span>
                    </div>
                    <div class="message received">
                        <div class="message-avatar">医</div>
                        <div class="message-content">怡老董事长于MG20年2月1日突然离世。经初步检查，死因疑似为仿生器官排异反应，但具体原因还需进一步化验。</div>
                    </div>
                    <div class="message sent">
                        <div class="message-content">我马上到。请务必保护好现场，不要让任何人接触相关的医疗记录，我怀疑这不是简单的排异反应。</div>
                        <div class="message-avatar">怡</div>
                    </div>
                </div>
                <!-- 聊天输入工具栏 -->
                <div class="chat-toolbar">
                    <button class="tool-btn"><i class="fas fa-microphone"></i></button>
                    <div class="input-box" contenteditable="true" placeholder="输入消息..."></div>
                    <button class="tool-btn"><i class="far fa-smile"></i></button>
                    <button class="tool-btn"><i class="fas fa-plus-circle"></i></button>
                </div>
            </div>

            <!-- 聊天窗口 3: 侦探社 -->
            <div class="chat-view" id="chatDetective">
                <div class="chat-header">
                    <button class="chat-back-btn" onclick="backToSessions()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="chat-contact-name">嘿嘿嘿侦探社</div>
                    <button class="chat-more-btn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="chat-messages">
                    <div class="message-date">
                        <span class="date-label">MG20年3月5日 18:00</span>
                    </div>
                    <div class="message received">
                        <div class="message-avatar">侦</div>
                        <div class="message-content">鸥，数据显示，更换仿生器官的富豪死亡率比贫民高出300%。这绝不是巧合。甄漂亮医院一定藏着秘密，我们查到他们的器官来源存在重大问题。</div>
                    </div>
                </div>
                <!-- 聊天输入工具栏 -->
                <div class="chat-toolbar">
                    <button class="tool-btn"><i class="fas fa-microphone"></i></button>
                    <div class="input-box" contenteditable="true" placeholder="输入消息..."></div>
                    <button class="tool-btn"><i class="far fa-smile"></i></button>
                    <button class="tool-btn"><i class="fas fa-plus-circle"></i></button>
                </div>
            </div>

            <!-- 聊天窗口 4: 文件传输助手 -->
            <div class="chat-view" id="chatHelper">
                <div class="chat-header">
                    <button class="chat-back-btn" onclick="backToSessions()">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <div class="chat-contact-name">文件传输助手</div>
                    <button class="chat-more-btn">
                        <i class="fas fa-ellipsis-v"></i>
                    </button>
                </div>
                <div class="chat-messages">
                    <div class="message-date">
                        <span class="date-label">MG20年3月18日 23:33</span>
                    </div>
                    <div class="message sent">
                        <div class="message-content">计划已定。让怼怼扮成我，我去扮成她。甄初升，就让我们看看，谁才是最后的赢家。我要让他为所有的罪行付出代价，包括爷爷的死。</div>
                        <div class="message-avatar">怡</div>
                    </div>
                </div>
                <!-- 聊天输入工具栏 -->
                <div class="chat-toolbar">
                    <button class="tool-btn"><i class="fas fa-microphone"></i></button>
                    <div class="input-box" contenteditable="true" placeholder="输入消息..."></div>
                    <button class="tool-btn"><i class="far fa-smile"></i></button>
                    <button class="tool-btn"><i class="fas fa-plus-circle"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 定义会话数据，包含最后一条消息的时间戳和内容
        const sessionsData = [
            {
                id: 'oldman',
                name: '老爷子',
                avatar: '老',
                lastMessageTime: new Date('2023-05-12T08:45:00').getTime(), // 转换为时间戳
                lastMessage: '不用去了，有方法解决X病毒了。',
                displayTime: '今天'
            },
            {
                id: 'doctor',
                name: '不重要的主治医生',
                avatar: '医',
                lastMessageTime: new Date('2023-02-01T05:22:00').getTime(),
                lastMessage: '怡老董事长于MG20年2月1日突然离世。',
                displayTime: '昨天'
            },
            {
                id: 'detective',
                name: '嘿嘿嘿侦探社',
                avatar: '侦',
                lastMessageTime: new Date('2023-03-05T18:00:00').getTime(),
                lastMessage: '数据显示，更换仿生器官的富豪死亡率比贫民高出300%...',
                displayTime: '星期三'
            },
            {
                id: 'helper',
                name: '文件传输助手',
                avatar: '文',
                lastMessageTime: new Date('2023-03-18T23:33:00').getTime(),
                lastMessage: '计划已定。让怼怼扮成我，我去扮成她...',
                displayTime: '3-18'
            }
        ];

        // 1. 按最后消息时间倒序排序（最新的在最上面）
        sessionsData.sort((a, b) => b.lastMessageTime - a.lastMessageTime);

        // 2. 动态生成会话列表
        function renderSessionsList() {
            const sessionsList = document.getElementById('sessionsList');
            sessionsList.innerHTML = ''; // 清空现有内容
            
            sessionsData.forEach(session => {
                const sessionItem = document.createElement('div');
                sessionItem.className = 'session-item';
                sessionItem.dataset.chat = session.id;
                
                sessionItem.innerHTML = `
                    <div class="session-avatar">${session.avatar}</div>
                    <div class="session-info">
                        <div class="session-row1">
                            <div class="session-name">${session.name}</div>
                            <div class="session-time">${session.displayTime}</div>
                        </div>
                        <div class="session-row2">
                            <div class="session-preview">${session.lastMessage}</div>
                        </div>
                    </div>
                `;
                
                sessionsList.appendChild(sessionItem);
            });
            
            // 重新绑定点击事件
            bindSessionClickEvents();
        }

        // 3. 绑定会话点击事件 - 新增：进入聊天页时隐藏微信标题栏
        function bindSessionClickEvents() {
            document.querySelectorAll('.session-item').forEach(item => {
                item.addEventListener('click', function() {
                    // 隐藏微信首页标题栏
                    document.querySelector('.navbar-home').style.display = 'none';
                    // 切换到聊天窗口
                    const chatId = 'chat' + this.dataset.chat.charAt(0).toUpperCase() + this.dataset.chat.slice(1);
                    document.getElementById('sessionsList').parentElement.style.display = 'none';
                    document.querySelectorAll('.chat-view').forEach(view => view.style.display = 'none');
                    document.getElementById(chatId).style.display = 'flex';
                });
            });
        }

        // 4. 返回会话列表 - 新增：回到首页时显示微信标题栏
        function backToSessions() {
            // 显示微信首页标题栏
            document.querySelector('.navbar-home').style.display = 'flex';
            // 切换回会话列表
            document.getElementById('sessionsList').parentElement.style.display = 'block';
            document.querySelectorAll('.chat-view').forEach(view => view.style.display = 'none');
        }

        // 5. 实时更新时间
        function updateTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            document.getElementById('currentTime').textContent = `${hours}:${minutes}`;
        }

        // 6. 阻止输入框Enter键换行
        function setupInputBoxes() {
            document.querySelectorAll('.input-box').forEach(box => {
                box.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.innerHTML = '';
                    }
                });
            });
        }

        // 7. 添加下拉刷新功能
        function setupPullToRefresh() {
            const container = document.querySelector('.sessions-container');
            const pullToRefresh = document.getElementById('pullToRefresh');
            let startY = 0;
            let currentY = 0;
            let isDragging = false;

            container.addEventListener('touchstart', (e) => {
                startY = e.touches[0].pageY;
                isDragging = true;
            });

            container.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                
                currentY = e.touches[0].pageY;
                const diff = currentY - startY;
                
                if (diff > 0 && container.scrollTop === 0) {
                    pullToRefresh.style.top = `${diff}px`;
                    if (diff > 60) {
                        pullToRefresh.textContent = '释放刷新';
                    } else {
                        pullToRefresh.textContent = '下拉刷新';
                    }
                }
            });

            container.addEventListener('touchend', () => {
                if (pullToRefresh.offsetTop > 60) {
                    pullToRefresh.textContent = '正在刷新...';
                    // 模拟刷新操作
                    setTimeout(() => {
                        pullToRefresh.style.top = '-40px';
                        pullToRefresh.textContent = '下拉刷新';
                        // 这里可以添加实际的刷新逻辑
                    }, 1000);
                } else {
                    pullToRefresh.style.top = '-40px';
                }
                isDragging = false;
            });
        }

        // 8. 添加消息发送功能
        function setupSendMessage() {
            document.querySelectorAll('.input-box').forEach(inputBox => {
                inputBox.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        const message = this.innerText.trim();
                        if (message) {
                            // 获取当前聊天窗口
                            const chatView = this.closest('.chat-view');
                            const messagesContainer = chatView.querySelector('.chat-messages');
                            
                            // 创建新的发送消息
                            const messageDiv = document.createElement('div');
                            messageDiv.className = 'message sent';
                            messageDiv.innerHTML = `
                                <div class="message-content">${message}</div>
                                <div class="message-avatar">怡</div>
                            `;
                            
                            messagesContainer.appendChild(messageDiv);
                            this.innerHTML = '';
                            
                            // 滚动到底部
                            messagesContainer.scrollTop = messagesContainer.scrollHeight;
                        }
                    }
                });
            });
        }

        // 初始化应用
        function initApp() {
            // 渲染会话列表
            renderSessionsList();
            
            // 设置输入框
            setupInputBoxes();
            
            // 启动时钟
            updateTime();
            setInterval(updateTime, 60000);
            
            // 设置下拉刷新
            setupPullToRefresh();
            
            // 设置消息发送
            setupSendMessage();
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>



